:root {
  /* Light Theme Variables */
  --primary: #6c5ce7;
  --secondary: #a29bfe;
  --accent: #00cec9;
  --bg: #dfe6e9;
  --card-bg: #ffffff;
  --text: #2d3436;
  --success: #2ecc71;
  --error: #ff1900;
  /* NEW: Theme Toggle Button Color */
  --theme-btn-color: #ffffff;
  --theme-btn-bg: rgba(255, 255, 255, 0.12);
}

/* Dark Theme Variables */
body.dark-mode {
  --primary: #bb86fc; /* Purple */
  --secondary: #03dac6; /* Teal */
  --accent: #ffeb3b; /* Yellow */
  --bg: #121212; /* Dark background */
  --card-bg: #1e1e1e; /* Darker card background */
  --text: #e0e0e0; /* Light text */
  --success: #4caf50;
  --error: #cf6679;
  /* NEW: Theme Toggle Button Color */
  --theme-btn-color: var(--text);
  --theme-btn-bg: var(--card-bg);
}

/* Add transition for smooth theme change */
body,
.stat-item,
.add-box,
.shop-item-card,
.card-front,
.card-back,
.bilingual-card,
.play-section,
.advanced-section,
.auth-modal,
.nav button,
.utility-buttons button {
  transition:
    background-color 0.4s ease,
    color 0.4s ease,
    border-color 0.4s ease;
}
/* Ensure input fields transition correctly */
input,
textarea {
  transition:
    border-color 0.3s,
    background-color 0.3s,
    color 0.3s;
  background-color: var(--card-bg); /* Use card-bg for consistency */
  color: var(--text); /* Use text for consistency */
}
input:focus,
textarea:focus {
  border-color: var(--primary);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Segoe UI", sans-serif;
}

body {
  background-color: var(--bg);
  color: var(--text);
  padding-bottom: 50px;
}

/* Header */
header {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  padding: 1.5rem 2rem;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  border-bottom-left-radius: 30px;
  border-bottom-right-radius: 30px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  flex-wrap: wrap;
}

.brand {
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
}
.brand h1 {
  font-size: 1.6rem;
}
.brand p {
  opacity: 0.9;
  font-size: 0.9rem;
}

/* Nav */
.nav,
.utility-buttons {
  display: flex;
  gap: 10px;
}
.nav button,
.utility-buttons button {
  background: var(--theme-btn-bg); /* Sử dụng biến */
  color: var(--theme-btn-color); /* Sử dụng biến */
  border: none;
  padding: 10px 14px;
  border-radius: 10px;
  cursor: pointer;
  transition: 0.15s;
  font-weight: 600;
  white-space: nowrap; /* Ngăn nút bị xuống dòng */
}
.nav button.active,
.nav button:hover,
.utility-buttons button:hover {
  background: rgba(255, 255, 255, 0.25);
  transform: translateY(-2px);
}

/* Dark Mode Fix for Header Buttons */
body.dark-mode .nav button.active,
body.dark-mode .nav button:hover,
body.dark-mode .utility-buttons button:hover {
  background: var(--secondary);
  color: var(--text);
  transform: translateY(-2px);
}
body.dark-mode .nav button.active {
  background: var(--secondary);
}
/* End Dark Mode Fix */

header h1 {
  margin-bottom: 0.2rem;
}

/* Container */
.container {
  max-width: 1000px;
  margin: 20px auto;
  padding: 20px;
}

/* Dashboard */
.dashboard {
  background: var(--card-bg);
  padding: 25px;
  border-radius: 20px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
  margin-bottom: 30px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  text-align: center;
}
.stat-item {
  padding: 15px;
  border-radius: 12px;
  background: var(--bg);
}
.stat-item h3 {
  font-size: 2rem;
  margin: 5px 0;
  color: var(--primary);
}
.stat-item p {
  font-size: 0.9rem;
  opacity: 0.8;
}

/* Form Adding */
.add-box {
  background: var(--card-bg);
  padding: 25px;
  border-radius: 20px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
  margin-bottom: 30px;
  /* Chỉnh sửa grid để thêm input file */
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  align-items: center;
}
/* Đảm bảo nút "Thêm Thẻ" chiếm hết chiều rộng */
.add-box button.btn-add {
  grid-column: 1 / -1;
}
.add-box input[type="file"] {
  padding: 9px;
  border: 2px dashed #ccc;
}

/* NEW CSS: Điều khiển input ảnh */
.input-toggle {
  text-align: right;
  font-size: 0.9rem;
  color: #666;
  margin-top: 5px;
}

/* Đảm bảo khu vực nhập ảnh chiếm trọn 2 cột */
.add-box #imageInputControl,
.add-box #textEntryImageInputControl {
  grid-column: 1 / -1;
}

/* Advanced form - 2 columns */
#section-advanced .advanced-section > div:first-of-type {
  display: grid;
  gap: 12px;
  grid-template-columns: 1fr 1fr;
}
#section-advanced .advanced-section input[type="file"],
#section-advanced .advanced-section textarea,
#section-advanced .advanced-section #advImageInput {
  grid-column: 1 / -1; /* Chiếm 2 cột */
}

/* Thẻ Văn Bản/Song Ngữ */
.bilingual-card {
  background: var(--bg);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
  margin-bottom: 15px;
  position: relative;
  overflow: hidden;
}
.bilingual-card h3 {
  color: var(--primary);
  font-size: 1.4rem;
  margin-bottom: 10px;
  border-bottom: 2px solid var(--secondary);
  padding-bottom: 5px;
}
.bilingual-card p {
  font-size: 1rem;
  line-height: 1.6;
  white-space: pre-wrap;
}
.bilingual-card .bilingual-body-en {
  color: #555;
  font-style: italic;
  margin-top: 10px;
  padding-top: 5px;
  border-top: 1px dashed #ccc;
}
/* Dark Mode Fix */
body.dark-mode .bilingual-card .bilingual-body-en {
  color: var(--text);
  opacity: 0.7;
  border-top: 1px dashed var(--text);
}
body.dark-mode .input-toggle {
  color: var(--text);
  opacity: 0.7;
}
/* End Dark Mode Fix */

.bilingual-card .delete-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: var(--error);
  color: white;
  border: none;
  padding: 5px 10px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.8rem;
  transition: 0.2s;
}
.bilingual-card .delete-btn:hover {
  opacity: 0.8;
}
.bilingual-card .text-link {
  display: block;
  margin-top: 10px;
  font-size: 0.9rem;
  color: var(--accent);
  word-break: break-all;
}
.bilingual-card .text-link img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  margin-top: 10px;
}

input,
textarea {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #eee;
  border-radius: 12px;
  font-size: 1rem;
  transition: 0.3s;
}
/* Dark Mode Fix */
body.dark-mode input,
body.dark-mode textarea {
  border: 2px solid #333;
}
/* End Dark Mode Fix */

textarea {
  min-height: 80px;
  resize: vertical;
}

input:focus,
textarea:focus {
  border-color: var(--primary);
  outline: none;
}

button.btn-add {
  background: var(--primary);
  color: white;
  border: none;
  padding: 12px 25px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: bold;
  transition: 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
}

button.btn-add:hover {
  background: var(--secondary);
  transform: scale(1.05) translateY(-1px);
}

/* Grid Cards */
.grid-cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 25px;
}

/* --- Shop Item Card Styles --- */
.shop-item-card {
  background: var(--card-bg);
  border-radius: 20px;
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.1);
  padding: 20px;
  transition: transform 0.2s;
  height: 100%; /* Đảm bảo thẻ chiếm đủ không gian trong grid */
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}
.shop-item-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
}
.shop-item-card h3 {
  font-size: 1.4rem;
  margin-bottom: 5px;
  color: var(--accent);
}
.shop-item-card p {
  font-size: 0.9rem;
  color: #555;
  text-align: left;
  margin-bottom: 15px;
}
/* Dark Mode Fix */
body.dark-mode .shop-item-card p {
  color: var(--text);
  opacity: 0.8;
}
/* End Dark Mode Fix */

.shop-item-card .shop-footer {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: auto; /* Đẩy footer xuống dưới */
  padding-top: 10px;
  border-top: 1px solid #eee;
  /* Dark Mode Fix */
  border-top: 1px solid var(--bg);
  /* End Dark Mode Fix */
}
/* --- END Shop Item Card Styles --- */

/* --- Flashcard Styles & Flip Effect (Optimized) --- */
.card-container {
  background-color: transparent;
  width: 100%;
  height: 320px;
  perspective: 1000px;
  cursor: pointer;
  transition:
    transform 0.3s ease-out,
    box-shadow 0.3s ease-out;
}
.card-container:not(.flipped):hover {
  transform: translateY(-5px) scale(1.02);
  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
}
/* Đánh dấu thẻ cần ôn tập bằng viền đỏ */
.card-container.needs-review .card-inner {
  border: 4px solid var(--error);
  box-shadow: 0 8px 18px rgba(231, 76, 60, 0.4);
}
.card-container.needs-review .card-front::before {
  background: var(--error);
}

.card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  text-align: center;
  transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  transform-style: preserve-3d;
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.1);
  border-radius: 20px;
}

.card-container.flipped .card-inner {
  transform: rotateY(180deg);
}

.card-front,
.card-back {
  position: absolute;
  width: 100%;
  height: 100%;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  border-radius: 20px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 20px;
  background: white;
  overflow: hidden;
  transition: all 0.3s;
}

/* Hiệu ứng nổi bật cho mặt trước */
.card-front::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 6px;
  background: var(--primary);
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
  transition: background 0.3s;
}
/* Dark Mode Fix */
body.dark-mode .card-front {
  background: var(--card-bg);
  color: var(--text);
}
body.dark-mode .card-front::before {
  background: var(--primary);
}
/* End Dark Mode Fix */

/* Front Side */
.card-front img {
  width: 100%;
  height: 160px;
  object-fit: cover;
  border-radius: 12px;
  margin-bottom: 15px;
}

.card-front h3 {
  font-size: 1.8rem;
  color: var(--primary);
}
.card-front .sentence {
  font-size: 0.9rem;
  color: #555;
  margin-top: 6px;
}
.card-front .hint {
  font-size: 0.8rem;
  color: var(--secondary);
  margin-top: 10px;
  display: flex;
  align-items: center;
  gap: 5px;
}
/* Dark Mode Fix */
body.dark-mode .card-front .sentence,
body.dark-mode .card-front .hint {
  color: var(--text);
  opacity: 0.8;
}
/* End Dark Mode Fix */

/* Back Side */
.card-back {
  background: linear-gradient(135deg, var(--secondary), var(--primary));
  color: white;
  transform: rotateY(180deg);
  position: relative;
}

.card-back h3 {
  font-size: 1.6rem;
  margin-bottom: 12px;
  letter-spacing: 1px;
}
.card-back p {
  font-size: 1.15rem;
  opacity: 0.95;
  padding: 0 10px;
}

/* Action Buttons */
.actions {
  position: absolute;
  bottom: 15px;
  right: 15px;
  z-index: 10;
  display: flex;
  gap: 5px;
}

.btn-icon {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  color: white;
  width: 35px;
  height: 35px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-icon:hover {
  background: rgba(255, 255, 255, 0.4);
}
.btn-delete:hover {
  background: #ff7675;
  transform: scale(1.1);
}
.btn-review:hover {
  background: #f1c40f;
  transform: scale(1.1);
  color: var(--text);
}

/* Notification */
.empty-state {
  text-align: center;
  grid-column: 1 / -1;
  padding: 50px;
  color: #b2bec3;
}

/* Play section */
.play-section,
.advanced-section {
  background: var(--card-bg);
  padding: 25px;
  border-radius: 20px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
}

.play-controls {
  display: flex;
  gap: 10px;
  margin-top: 20px;
  flex-wrap: wrap;
}

/* --- Game Mode containers --- */
/* --- CSS SỬA ĐỔI CHO LỚP PHỦ VÀ HIỆU ỨNG MỜ (BLUR) --- */

#playCardContainer {
  /* Giữ nguyên các thuộc tính container đã có */
  min-height: 450px;
  padding: 20px;
  background: var(--bg); /* Giữ lại màu nền mặc định */
  border-radius: 15px;
  text-align: center;
  position: relative; /* Đảm bảo ::before hoạt động đúng */
  /* ... các thuộc tính khác ... */
}

/* 1. Lớp phủ (Overlay) VÀ HIỆU ỨNG MỜ (BLUR) */
#playCardContainer::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: inherit;

  /* 1a. Tăng lớp phủ màu đen (để chữ rõ ràng) */
  background-color: rgba(0, 0, 0, 0.155);

  /* 1b. BỔ SUNG: Áp dụng hiệu ứng mờ lên LỚP NỀN BÊN DƯỚI */
  /* Điều chỉnh giá trị 3px để tăng/giảm độ mờ */
  backdrop-filter: blur(3px);
  -webkit-backdrop-filter: blur(3px); /* Hỗ trợ trình duyệt Webkit */

  z-index: 1; /* Đặt dưới nội dung */
}

/* 2. Đảm bảo nội dung (chữ, nút) nằm trên lớp phủ */
#playCardContainer > * {
  position: relative;
  z-index: 2;
}

#playWord {
  margin-top: 150px;
  /* BỔ SUNG: Tạo lớp nền nhẹ cho chữ */
  display: inline-block;
  /* Quan trọng: Để background chỉ bao quanh nội dung chữ */
  /* Màu nền */
  background-color: rgba(255, 255, 255, 0.534);

  padding: 8px 15px;
  /* Thêm đệm xung quanh chữ cho dễ nhìn */

  /* BỔ SUNG: BO GÓC TRÒN */
  border-radius: 8px;
  /* Điều chỉnh giá trị này để tăng/giảm độ cong */

  /* Thay đổi để chữ tự điều chỉnh kích thước và xuống dòng nếu cần */
  font-size: clamp(
    1.5rem,
    6vw,
    2.5rem
  ); /* Kích thước linh hoạt: Min 1.5rem, Max 2.5rem, ưu tiên 6% Viewport Width */
  word-break: break-word; /* Cho phép từ quá dài xuống dòng */

  color: #ffd300;

  /* Đảm bảo chữ vẫn nổi bật trên nền */
  text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.9);
}

/* ... Giữ các CSS khác liên quan đến màu chữ sáng và đổ bóng ... */

/* Multiple Choice specific styles */
.multiple-choice-options {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-top: 15px;
}
.mc-option {
  background: var(--bg);
  border: 2px solid #ccc;
  padding: 10px;
  border-radius: 10px;
  cursor: pointer;
  transition: 0.2s;
  text-align: center;
  font-size: 1rem;
}
/* Dark Mode Fix */
body.dark-mode .mc-option {
  border-color: #333;
}
/* End Dark Mode Fix */

.mc-option:hover:not(.disabled) {
  background: var(--secondary);
  color: white;
  border-color: var(--secondary);
}
.mc-option.selected {
  border-color: var(--primary);
  background: var(--primary);
  color: white;
}
.mc-option.correct {
  background: var(--success);
  color: white;
  border-color: var(--success);
  font-weight: bold;
}
.mc-option.incorrect {
  background: var(--error);
  color: white;
  border-color: var(--error);
  font-weight: bold;
}
.mc-option.disabled {
  opacity: 0.7;
  cursor: default;
}

/* --- Jumble Word Styles --- */
#jumbledAnswerDisplay {
  height: 50px;
  margin: 15px auto;
  border-bottom: 3px solid var(--primary);
  padding: 5px 0;
  font-size: 2rem;
  font-weight: bold;
  letter-spacing: 5px;
  color: red;
  min-width: 80%;
}

#jumbleOptionsArea {
  display: flex;
  justify-content: center;
  gap: 5px;
  flex-wrap: wrap;
  margin-top: 10px;
  min-height: 40px;
}

.char-button {
  background: var(--secondary);
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  font-size: 1.2rem;
  transition: 0.1s;
  box-shadow: 0 3px #6c5ce7;
}
/* Dark Mode Fix */
body.dark-mode .char-button {
  box-shadow: 0 3px var(--primary);
}
body.dark-mode .char-button:hover:not(.used) {
  box-shadow: 0 5px var(--primary);
}
/* End Dark Mode Fix */

.char-button:hover:not(.used) {
  transform: translateY(-2px);
  box-shadow: 0 5px #6c5ce7;
}

.char-button.used {
  opacity: 0.4;
  cursor: default;
  transform: none;
  box-shadow: none;
}
/* --- End Jumble Word Styles --- */

/* --- Matching Game Styles (NEW) --- */
#matchingGameArea {
  display: none;
  /* ĐÃ SỬA: Đặt thành 4 cột cho layout 4x6 (24 thẻ) */
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
  margin-top: 15px;
  min-height: 400px; /* Đảm bảo chiều cao đủ */
  padding: 10px;
  background: #f7f9fa;
  border-radius: 15px;
  /* Dark Mode Fix */
  background: var(--bg);
  /* End Dark Mode Fix */
}

.matching-card {
  background-color: transparent;
  height: 120px;
  perspective: 1000px;
  cursor: pointer;
}

.matching-card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  text-align: center;
  transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  transform-style: preserve-3d;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.matching-card.flipped .matching-card-inner {
  transform: rotateY(180deg);
}

/* ĐÃ SỬA LỖI MẤT CHỮ KHI TRÙNG KHỚP (Từ lần sửa trước) */
.matching-card.matched .matching-card-inner {
  transform: rotateY(180deg);
  opacity: 1;
  box-shadow: 0 0 0 rgba(0, 0, 0, 0);
  transition: all 0.5s ease-out;
  cursor: default;
}
/* END: ĐÃ SỬA LỖI MẤT CHỮ KHI TRÙNG KHỚP */

.matching-card-front,
.matching-card-back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 10px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 5px;
  overflow: hidden;
}

/* Mặt sau (Nội dung) */
.matching-card-back {
  background: linear-gradient(145deg, var(--accent), #00b894);
  color: white;
  transform: rotateY(180deg);
  font-size: 0.9rem;
  font-weight: 500;
  line-height: 1.2;
}

/* Mặt sau khi đã trùng khớp có thể đổi màu để nổi bật */
.matching-card.matched .matching-card-back {
  background: var(--success);
}

/* Mặt trước (Che) */
.matching-card-front {
  background: var(--primary);
  color: white;
  font-size: 2rem;
  font-weight: bold;
}

/* Mặt trước khi đã trùng khớp có thể đổi màu/chữ để nổi bật */
.matching-card.matched .matching-card-front {
  background: var(--success);
  font-size: 1.2rem;
}
/* --- End Matching Game Styles --- */

/* Toast Notification CSS */
#toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.toast {
  background-color: var(--text);
  color: white;
  padding: 15px 20px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  min-width: 250px;
  opacity: 0;
  transform: translateX(100%);
  transition:
    opacity 0.4s ease-out,
    transform 0.4s ease-out;
}
.toast.show {
  opacity: 1;
  transform: translateX(0);
}
.toast.success {
  background-color: var(--success);
}
.toast.error {
  background-color: var(--error);
}
.toast.info {
  background-color: var(--secondary);
}

/* =================================================== */
/* NEW CSS: Auth/Edit Modal (Login/Register/Edit) */
/* =================================================== */

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  z-index: 100;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 0.3s,
    visibility 0.3s;
}

.modal-overlay.visible {
  opacity: 1;
  visibility: visible;
}

.auth-modal {
  background: var(--card-bg);
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
  max-width: 400px; /* Default for login/register */
  width: 90%;
  transform: scale(0.9);
  transition: transform 0.3s ease-out;
  position: relative;
}

.modal-overlay.visible .auth-modal {
  transform: scale(1);
}

.auth-modal h2 {
  text-align: center;
  color: var(--primary);
  margin-bottom: 20px;
  font-size: 1.8rem;
}

.auth-form {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.auth-input {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #ccc;
  border-radius: 12px;
  font-size: 1rem;
}
/* Dark Mode Fix */
body.dark-mode .auth-input {
  border-color: #333;
}
/* End Dark Mode Fix */

.btn-auth {
  background: var(--primary);
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: bold;
  transition: 0.2s;
}

.btn-auth:hover {
  background: var(--secondary);
}

.auth-toggle {
  text-align: center;
  margin-top: 15px;
  font-size: 0.9rem;
}

.auth-toggle a {
  color: var(--primary);
  text-decoration: none;
  font-weight: 600;
  cursor: pointer;
}

.close-button {
  position: absolute;
  top: 10px;
  right: 10px;
  background: none;
  border: none;
  font-size: 1.5rem;
  color: #888;
  cursor: pointer;
  transition: color 0.2s;
}

.close-button:hover {
  color: var(--error);
}
/* =================================================== */
/* End NEW CSS */
/* =================================================== */

/* Responsive */
@media (max-width: 768px) {
  header {
    flex-direction: column;
    align-items: flex-start;
  }
  .nav {
    order: 3;
    width: 100%;
    flex-wrap: wrap;
  }
  .utility-buttons {
    order: 2;
    margin-top: 10px;
  }
  .add-box {
    grid-template-columns: 1fr;
  }
  header h1 {
    font-size: 1.2rem;
  }
  .brand p {
    display: none;
  }
  .multiple-choice-options {
    grid-template-columns: 1fr; /* 1 cột trên mobile */
  }
  /* THAY ĐỔI: Chuyển về 3 cột trên mobile để card không quá nhỏ */
  #matchingGameArea {
    grid-template-columns: repeat(3, 1fr);
  }

  /* Cập nhật responsive cho Advanced Form */
  #section-advanced .advanced-section > div:first-of-type {
    grid-template-columns: 1fr; /* FIX: Chuyển về 1 cột trên mobile */
  }
} /* FIX: Thêm dấu đóng cho @media query */

#section-advanced .advanced-section input[type="file"],
#section-advanced .advanced-section textarea,
#section-advanced .advanced-section #advImageInput {
  grid-column: 1 / -1;
}

/* hidden helper */
.hidden {
  display: none;
}
.force-hidden {
  /* Dùng cho các thành phần UI của chế độ chơi khác */
  display: none !important;
}
/* NEW: Edit Button Style */
.btn-edit {
  background: var(--accent);
}
.btn-edit:hover {
  background: #00b894; /* slightly darker accent */
  transform: scale(1.1);
}
/* End NEW */

/* Thêm vào khối <style> của bạn */
.card-front .sentence {
  margin-top: 5px; /* Khoảng cách nhỏ với từ vựng */
  font-size: 1.1rem; /* Kích thước lớn hơn so với nghĩa, gần bằng từ vựng */
  color: var(--text); /* Màu chữ chính, hoặc màu khác nổi bật */
  font-weight: 500;
  font-style: italic; /* Giúp phân biệt với từ vựng chính */
  text-align: center;
}

/* Đảm bảo từ vựng vẫn lớn nhất */
.card-front h3 {
  font-size: 1.8rem;
  color: var(--primary);
}

/* NEW CSS for Item Inventory Bar in Play Section */
#inventory-bar {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin-top: 20px;
  padding: 10px;
  background: var(--bg); /* Nền nhẹ hơn */
  border-radius: 15px;
  box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
}

.inventory-item {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: var(--primary); /* Màu chủ đạo */
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition:
    transform 0.2s,
    box-shadow 0.2s,
    background 0.2s;
  position: relative;
  overflow: hidden;
  font-size: 0.7rem;
  font-weight: bold;
  text-align: center;
}

.inventory-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  background: var(--secondary);
}

.inventory-item i {
  font-size: 1.2rem;
  margin-bottom: 2px;
}

.inventory-count {
  position: absolute;
  bottom: 0px;
  right: 0px;
  background: var(--accent); /* Màu nổi bật cho số lượng */
  color: var(--text);
  width: 16px;
  height: 16px;
  border-radius: 50%;
  line-height: 16px;
  font-size: 0.6rem;
  text-align: center;
  border: 2px solid var(--bg);
}

/* Đổi màu cho câu ví dụ/gợi ý */
#playSentence {
  /* Sử dụng màu đỏ nhạt (#ff9999) hoặc một biến màu nhạt hơn nếu có */
  color: #ff9999;
}

/* ------------------------------------------- */
/* CSS cho Hiệu ứng Vòng tròn Level và Animation */
/* ------------------------------------------- */

/* Vòng tròn chính bao quanh Level */
.level-circle-container {
  position: relative;
  width: 120px;
  height: 120px;
  margin: 15px auto; /* Canh giữa */
  border-radius: 50%;
  /* Màu nền tĩnh cho phần chưa có EXP */
  background: #e0e0e0;
}

/* Thanh Tiến độ Vòng tròn (ĐÃ SỬA LỖI VỆT SÁNG VÀ VỊ TRÍ BẮT ĐẦU) */
.level-progress-bar {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 50%;

  /* Biến CSS (JS cập nhật giá trị 0-100) */
  --progress: 0;

  /* Vẽ thanh tiến độ bằng conic-gradient dựa trên biến --progress */
  background: conic-gradient(
    /* BỔ SUNG: Bắt đầu ở đỉnh (12 giờ) */ from 0deg,
    /* Màu tiến trình: chạy từ 0 đến [progress * 3.6] độ */ var(--primary)
      calc(var(--progress) * 3.6deg),
    /* Màu nền: bắt đầu ngay tại [progress * 3.6] độ và chạy đến 360 độ */
    #e0e0e0 calc(var(--progress) * 3.6deg)
  );

  /* Tạo hiệu ứng "Donut" (Vòng tròn rỗng) */
  mask: radial-gradient(transparent 48px, rgba(255, 255, 255, 0.899) 60px);

  /* Transition giúp vòng tròn chạy mượt mà khi EXP tăng */
  transition: background 0.5s ease-in-out;
}

/* Nội dung Cấp độ bên trong vòng tròn */
.level-content {
  position: absolute;
  z-index: 2;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);

  background: var(--card-bg);
  width: 96px;
  height: 96px;
  border-radius: 50%;

  /* Dùng Flex để căn giữa Level */
  display: flex;
  justify-content: center;
  align-items: center;
}

#currentLevel {
  margin: 0;
  font-size: 2.5rem;
  color: var(--primary);
}

/* --- ANIMATION --- */
@keyframes exp-pulse {
  0% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(108, 92, 231, 0.4);
  }
  50% {
    transform: scale(1.05);
    box-shadow: 0 0 0 10px rgba(108, 92, 231, 0);
  }
  100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(108, 92, 231, 0);
  }
}

.exp-gain-animation {
  animation: exp-pulse 0.6s ease-out;
}

@keyframes level-up-glow {
  0% {
    border-color: var(--primary);
  }
  50% {
    border-color: var(--accent);
    transform: scale(1.1);
  }
  100% {
    border-color: var(--primary);
    transform: scale(1);
  }
}
.level-up-animation .level-circle-container {
  animation: level-up-glow 0.8s ease-in-out;
  border: 3px solid var(--accent);
}

/* --- KEYFRAMES ĐỊNH NGHĨA CHUYỂN ĐỘNG --- */

@keyframes pulseExp {
  0% {
    transform: scale(1);
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
  }
  50% {
    transform: scale(1.02);
    box-shadow: 0 0 15px var(--accent);
  }
  100% {
    transform: scale(1);
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
  }
}

@keyframes levelUpGlow {
  0% {
    transform: scale(1);
    box-shadow: 0 0 0 var(--success);
  }
  25% {
    transform: scale(1.05) rotate(1deg);
    box-shadow: 0 0 40px var(--accent);
  }
  50% {
    transform: scale(1.07) rotate(-1deg);
    box-shadow: 0 0 60px var(--primary);
  }
  75% {
    transform: scale(1.05) rotate(1deg);
    box-shadow: 0 0 40px var(--accent);
  }
  100% {
    transform: scale(1);
    box-shadow: 0 0 0 var(--success);
  }
}

/* --- CLASSES KÍCH HOẠT HIỆU ỨNG --- */

/* Hiệu ứng khi cộng EXP thông thường */
.stat-item.pulse-exp {
  animation: pulseExp 0.4s ease-in-out;
}

/* Hiệu ứng khi Level Up (mạnh mẽ hơn) */
.stat-item.level-up-glow {
  border: 3px solid var(--primary);
  /* Chạy animation glow */
  animation: levelUpGlow 1.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
}

/* =================================================== */
/* CSS BỔ SUNG: Hiệu ứng và kiểu dáng cho thông báo kết quả game */
/* =================================================== */
#playResult.game-result-message {
  /* Kiểu dáng theo yêu cầu của bạn */
  font-weight: 600;
  margin-top: 10px;
  background-color: rgb(255, 247, 0); /* Màu vàng */
  padding: 8px 12px;
  border-radius: 122px; /* Bo góc cực tròn */
  color: var(--text);
  display: inline-block; /* Quan trọng để bao quanh nội dung */

  /* Điều khiển Opacity và Hiệu ứng */
  opacity: 0; /* 1. KHỞI TẠO: Độ mờ = 0 (Ẩn) */
  transition:
    opacity 0.3s ease-in-out,
    background-color 0.3s; /* Thêm chuyển động mượt mà */
}

/* Tối ưu cho Chế độ tối (Dark Mode) */
body.dark-mode #playResult.game-result-message {
  background-color: #fff707; /* Vàng đậm hơn cho dark mode */
}
/* =================================================== */
/* Hiệu ứng Viền Sáng Dùng Box-Shadow và Animation */
/* Áp dụng khi thẻ .card-container KHÔNG có .needs-review */
/* =================================================== */

.card-container:not(.needs-review) .card-front {
  /* Quan trọng: Cho phép box-shadow tạo hiệu ứng phát sáng */
  box-shadow: 
        /* Shadow 1: Màu Xanh Lam */
    0 0 10px 0 #00d5ffd4,
    0 0 20px 0 #00d5ffd8,
    /* Shadow 2: Màu Hồng/Tím */ 0 0 10px 0 #ff00e6d8,
    0 0 20px 0 #ff00e6d7;

  /* Thiết lập animation để làm box-shadow thay đổi */
  animation: glowingBorder 4s infinite alternate;
}

/* ---------------------------------------------------- */
/* Keyframes: Định nghĩa chuyển động và thay đổi màu */
/* ---------------------------------------------------- */
@keyframes glowingBorder {
  0% {
    /* Bắt đầu: Tím/Hồng mạnh, Xanh Lam nhẹ */
    box-shadow:
      0 0 12px 2px #ff00e6d5,
      0 0 25px 5px rgba(255, 0, 229, 0.5),
      0 0 5px 0 #00d5ffd3;
  }

  50% {
    /* Giữa: Xanh Lam mạnh, Tím/Hồng nhẹ */
    box-shadow:
      0 0 12px 2px #00d5ffd5,
      0 0 25px 5px rgba(0, 212, 255, 0.5),
      0 0 5px 0 #ff00e6d3;
  }

  100% {
    /* Kết thúc: Trở về trạng thái ban đầu (hoặc trạng thái hơi khác để tạo hiệu ứng thở/chạy) */
    box-shadow:
      0 0 12px 2px #ff00e6d6,
      0 0 25px 5px rgba(255, 0, 229, 0.5),
      0 0 5px 0 #00d5ffd7;
  }
}
/* Custom CSS cho Đồng hồ Bấm giờ */
.timer-stat-item {
  /* Đảm bảo đồng hồ có thể chiếm không gian lớn hơn nếu cần */
  grid-column: span 1;
  /* Căn giữa nội dung cho hiển thị đồng hồ */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.timer-stat-item h3 {
  font-size: 2em !important; /* Phóng to giờ hiển thị */
  color: var(--success); /* Màu xanh lá nổi bật */
  margin: 10px 0;
}

.timer-status-text {
  color: var(--accent);
  font-style: italic;
  margin-bottom: 5px;
}

.reset-message-text {
  font-size: 0.5em;
  color: #eaff00; /* Màu vàng nhạt */
  margin-bottom: 10px;
}

/* Định dạng giả lập EXP/Coin */
.mock-stats {
  display: flex;
  gap: 20px;
  margin-top: 10px;
  font-size: 1.1em;
}
.mock-stats span:first-child {
  color: #f1fa8c;
} /* EXP */
.mock-stats span:last-child {
  color: var(--primary);
} /* Coin */
